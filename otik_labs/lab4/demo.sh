#!/bin/bash
# Демонстрация возможностей лабораторной работы 4

echo "╔═══════════════════════════════════════════════════════════════════╗"
echo "║     Лабораторная работа 4: Энтропийное сжатие (Хаффман и др.)    ║"
echo "╚═══════════════════════════════════════════════════════════════════╝"
echo ""

# Проверка наличия тестового файла
if [ ! -f "../lab2/1.txt" ]; then
    echo "Создание тестового файла..."
    echo "Тестовый текст для демонстрации алгоритмов сжатия данных." > demo.txt
    TEST_FILE="demo.txt"
else
    TEST_FILE="../lab2/1.txt"
fi

echo "Используется файл: $TEST_FILE"
SIZE=$(stat -c%s "$TEST_FILE")
echo "Размер: $SIZE байт"
echo ""

# Демонстрация Л4.№2 - анализ разрядностей
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "  Л4.№2: Анализ эффективности разных разрядностей частот"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
python3 n2.py analyze "$TEST_FILE"
echo ""

# Демонстрация Л4.№1 - Хаффман
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "  Л4.№1: Сжатие методом Хаффмана"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
python3 n1.py encode "$TEST_FILE" demo_huffman.otik
HUFF_SIZE=$(stat -c%s "demo_huffman.otik")
COMPRESSION=$((100 - HUFF_SIZE * 100 / SIZE))
echo "Размер архива: $HUFF_SIZE байт (степень сжатия: $COMPRESSION%)"
echo ""

# Демонстрация Л4.№6 - Шеннон-Фано
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "  Л4.№6: Сжатие методом Шеннона-Фано"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
python3 n6.py encode "$TEST_FILE" demo_shannon.otik
SF_SIZE=$(stat -c%s "demo_shannon.otik")
COMPRESSION=$((100 - SF_SIZE * 100 / SIZE))
echo "Размер архива: $SF_SIZE байт (степень сжатия: $COMPRESSION%)"
echo ""

# Демонстрация Л4.№4 - интеллектуальный кодер
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "  Л4.№4: Интеллектуальный кодер (автоматический выбор)"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
python3 n4.py encode "$TEST_FILE" demo_smart.otik
SMART_SIZE=$(stat -c%s "demo_smart.otik")
COMPRESSION=$((100 - SMART_SIZE * 100 / SIZE))
echo "Размер архива: $SMART_SIZE байт (степень сжатия: $COMPRESSION%)"
echo ""

# Демонстрация Л4.№3 - универсальный декодер
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "  Л4.№3: Универсальный декодер"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "Распаковка архива Хаффмана..."
python3 n3.py decode demo_huffman.otik demo_huff_out.txt
echo ""
echo "Распаковка архива Шеннона-Фано..."
python3 n3.py decode demo_shannon.otik demo_sf_out.txt
echo ""
echo "Распаковка интеллектуального архива..."
python3 n3.py decode demo_smart.otik demo_smart_out.txt
echo ""

# Проверка корректности
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "  Проверка корректности распаковки"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
if diff "$TEST_FILE" demo_huff_out.txt > /dev/null; then
    echo "✓ Хаффман: распаковка корректна"
else
    echo "✗ Хаффман: ОШИБКА"
fi

if diff "$TEST_FILE" demo_sf_out.txt > /dev/null; then
    echo "✓ Шеннон-Фано: распаковка корректна"
else
    echo "✗ Шеннон-Фано: ОШИБКА"
fi

if diff "$TEST_FILE" demo_smart_out.txt > /dev/null; then
    echo "✓ Интеллектуальный: распаковка корректна"
else
    echo "✗ Интеллектуальный: ОШИБКА"
fi
echo ""

# Сводная таблица
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "  Сводная таблица размеров"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
printf "%-25s %10s %10s\n" "Метод" "Размер" "Сжатие"
echo "───────────────────────────────────────────────────"
printf "%-25s %10d %9d%%\n" "Исходный файл" $SIZE 0
printf "%-25s %10d %9d%%\n" "Хаффман" $HUFF_SIZE $((100 - HUFF_SIZE * 100 / SIZE))
printf "%-25s %10d %9d%%\n" "Шеннон-Фано" $SF_SIZE $((100 - SF_SIZE * 100 / SIZE))
printf "%-25s %10d %9d%%\n" "Интеллектуальный" $SMART_SIZE $((100 - SMART_SIZE * 100 / SIZE))
echo ""

# Очистка
echo "Очистка временных файлов..."
rm -f demo_*.txt demo_*.otik
[ -f "demo.txt" ] && rm -f demo.txt

echo ""
echo "╔═══════════════════════════════════════════════════════════════════╗"
echo "║                      Демонстрация завершена!                      ║"
echo "╚═══════════════════════════════════════════════════════════════════╝"
