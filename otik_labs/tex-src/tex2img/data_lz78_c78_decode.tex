\input{commonpath}
% \input{\SRCROOTPATH/widepresnocommon}

\documentclass[11pt]{extarticle} % дома (buster)

\usepackage{cmap}
\usepackage[T2A]{fontenc}
\usepackage[cp1251]{inputenc}
% \usepackage{tempora}
% \usepackage[defaultsans]{opensans}

\usepackage[english,russian]{babel}
\raggedbottom 	% не растягивать недозаполненные страницы по высоте, а оставлять место внизу


\usepackage{geometry}


\usepackage{amsmath,amssymb}
\usepackage{bm} % \bm
\usepackage{icomma}
\usepackage{mathtools}

\usepackage{graphicx}

\input{\COMMONPATH/preamble-complex/tikz2}
\input{\COMMONPATH/mixin-elementary/tikz-espdblocks2.tex}

\usepackage{ulem}

\newcommand{\hex}[1]{\ensuremath{\mathtt{#1}}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}
\scriptsize

\sffamily

\pagestyle{empty}

\resizebox{\linewidth}{!}{
\begin{tikzpicture}\scriptsize


   
\tikzstyle{normalblockheight}      = [minimum height=7ex]
% \tikzstyle{miniblockheight}      = [minimum height=4ex, minimum width=3em, ]
\tikzstyle{miniblockheight}      = [minimum height=4ex ]

\tikzstyle{normalblocksep}      = [inner sep = 0.2em]

\tikzstyle{curvedblockxsep}      = [inner xsep = 0em]
\tikzstyle{ddblockxsep}      = [inner xsep = -0.8em]


% размеры
\tikzstyle{normalblock}  = [normalblockheight, text width=8.5em, normalblocksep]

\tikzstyle{wideblock}        = [normalblockheight, text width=12em, normalblocksep]
\tikzstyle{narrowblock}      = [normalblockheight, text width=6em, normalblocksep]

\tikzstyle{normaldatafile} = [minimum width=7ex, minimum height=8em, normalblocksep] % для лежачего цилиндра высота — это width!

\tikzstyle{connector}=[espdconnector, minimum height=2ex, scale=0.7, normalblocksep]




\tikzset{node distance = 3ex and 2em}




\node[miniblockheight, espdblackcenter, espddata,                ] (N) {$N$};
\node[miniblockheight, espdblackcenter, espddata, below = of N,  ] (c) {$c$};

\node[fit=(N)(c), inner sep = 0.em] (Nc) {};


\coordinate[left = 1.5em of Nc] (arch_to_all);
\node[normaldatafile, espdblackcenter, espddatafile, left = 1em of arch_to_all] (arch)  {Архив};


\node[miniblockheight, espdblackcenter, espddata, right = of c,  ] (E1) {$E_{L+1} =E_L \cup c$};

% \node[miniblockheight, espdblackcenter, espddata,  ] (E) at (E1|-N) {$E_{L}$};
\node[miniblockheight, espdblackcenter, espddata, right = of N, ] (E) {$E_{L}$};


\node[fit=(E)(E1), inner sep = 0.em] (EE) {};
\node[narrowblock,   inner xsep = -0.8em, text width=4.6em,  espdblackcenter, espddata, above = of EE] (W) {Словарь};

% \node[normaldatafile, espdblackcenter, espddatafile, right = of E1] (C)  {$C = c_1 c_2 \ldots c_n 0\,0\ldots$};
    \node[normalblock,   inner xsep = -0.6em, espdblackcenter, espddata, right = of E1] (decode) {Декодированный: $c_1\, c_2 \ldots c_n 0\,0\ldots$};
    
    \node[normaldatafile, espdblackcenter, espddatafile, text width=8em, below = of decode] (C)  {Восстановленный файл $c_1\, c_2 \ldots c_n$};
%     \node[normaldatafile, espdblackcenter, espddatafile, text width=8em, below = of decode.south-|decode.top right corner, anchor = north east] (C)  {Восстановленный файл $c_1\, c_2 \ldots c_n$};
    
%     \node[narrowblock, espdblackcenter, espddata, below = of arch] (n)  {Длина исх.\,файла $n$};
%     \node[narrowblock, espdblackcenter, espddata] (n) at (arch|-C)  {Длина исх.\,файла $n$};
    \node[narrowblock, espdblackcenter, espddata, anchor = bottom left corner] (n) at (arch.west|-C.south)  {Длина исх.\,файла $n$};

    
 \node[wideblock,  espdblackcenter, espdprocess, anchor = west] (init_1) at (arch.west|-W) {\underline{Первичная инициализация:} 
        словарь $\big\{(0, \varnothing)\big\}$ };
   
    

\draw[espdstreamto] (init_1) -- (W);
   
    
\draw[espdstreamto] (arch) -- (arch_to_all) |- (N);
\draw[espdstreamto] (arch_to_all) |- (c);
    
\draw[espdstreamto] (arch.south-|n) -- (n);
  
\draw[espdstreamto] (N) -- (E);
\draw[espdstreamto] (c) -- (E1);

\draw[espdstreamto] (E|-W.south) -- (E|-E.north);
\draw[espdstreamto] (E|-E.south) -- (E|-E1.north);
  
\coordinate (E1_to_W_x)    at ($2*(W.bottom side)-(E)$);
\draw[espdstreamto] (E1_to_W_x|-E1.north) -- (E1_to_W_x|-W.south);
   
    
\draw[espdstreamto] (E1) -- (decode);
    
\draw[espdstreamto] (decode.south-|C) -- (C);
\draw[espdstreamto] (n) -- (C);
    
    
\end{tikzpicture}
}

\end{document}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
