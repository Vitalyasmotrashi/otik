\input{commonpath}
\input{\COMMONPATH/classes/book}


\begin{document}

\chapter{Коды Рида---Соломона}

\section{Построение кода}
\subsection{Выбор поля и~канал передачи данных}

Код Рида"--~Соломона "--- многочлен над некоторым конечным полем $GF(q)$.
По-хорошему, выбор поля определяется набором символов, передаваемых по каналу.

Как правило, на практике символом является 8-битный байт (октет), так что код строится над полем $GF(2^8) = GF(256)$ из 256 элементов.
Для доски ранее был принят 4-битный байт (тетрада), что требовало бы кода над полем $GF(2^4) = GF(16)$ из 16 элементов.

К сожалению, арифметические действия в~полях $GF(2^n)$ при $n>1$ контринтуитивны (сложение как $\mathrm{xor}$ и~умножение по таблице степеней примитивного элемента), поэтому на лекции и~здесь рассматриваются поля $GF(p) = \Integerset_p$ из простого количества элементов $p>2$ (арифметические действия по модулю $p$).

На данном семинаре было выбрано поле $GF(7) = \Integerset_7$ из семи элементов: $0, 1, 2, 3, 4, 5, 6$. 
Это соответствует гипотетическому каналу, который умеет передавать символы $\{0, 1, 2, 3, 4, 5, 6\}$ и только их. Ошибка передачи "--- это замена одного из символов сообщения на другой символ из набора $\{0, 1, 2, 3, 4, 5, 6\}$.

\subsubsection{К вопросу «как это реализовать?»}

Канал, передающий сообщения на семисимвольном алфавите, можно эмулировать как каналом, передающим октеты, так и~каналом, передающим 32-битные числа ($int$ или $unsigned$), так как в~обоих случаях алфавит поля $\Integerset_7$ (множество символов $A_7 = \{0, 1, 2, 3, 4, 5, 6\}$) "--- часть алфавита канала $A$:
\begin{enumerate}
\item При передаче символа $a \in A_7 \subseteq A$ передаётся  символ $a$.
Значения из~$A\setminus A_7$ %(в том числе $7, 8, 9, ...$ и т.\,п.) 
никогда не передаются.

\item При получении символа $a \in A_7 \subseteq A$ он воспринимается как $a$.

При получении символа $b \in A\setminus A_7$ (любого, кроме $0, 1, 2, 3, 4, 5, 6$) он воспринимается как один из символов $A_7$ "--- например, всегда как $0$; или как случайно выбранный от $0$ до $6$.

\end{enumerate}

\subsection{Длина кода}

Максимально возможная длина кода (общее число информационных и проверочных символов) равна количеству ненулевых элементов (6 для $\Integerset_7$).

При желании "--- можно меньше (взять меньше информационных на то же число проверочных; так, для $GF(256)$ максимальная длина 255 нечётна).

Если ниже  взять не примитивный $\beta$ "--- это технически возможно, но максимальная длина кода будет равна его порядку $<6$ $\implies$ не используется.

%Если ниже в~качестве $\beta$ 

\subsection{Примитивный элемент}

Для построения кода Рида"--~Соломона необходим примитивный элемент поля $\beta$.
На семинаре был выбран $\beta = 3$:

$
\begin{array}{cclclclclcl@{}}
\beta^0 &=& 1\\
\beta^1 &=& 3\\
\beta^2 &=& 2\\
\beta^3 &=& 6\\
\beta^4 &=& 4\\
\beta^5 &=& 5\\
\beta^6 &=& 1\\
\end{array}
$

Все шесть (по Малой теореме Ферма, $x^{p-1}$ в~любом случае равно 1) степеней разные $\implies$ 3 "--- действительно примитивный элемент $\Integerset_7$.

\subsection{Степень порождающего полинома Рида---Соломона = число проверочных символов $\kappa$}

В~блоке Рида"--~Соломона с~$\kappa$ проверочных символов может быть исправлено до $\left\lfloor\frac{\kappa}{2}\right\rfloor$ ошибок.

Таким образом, по-хорошему-2, выбор числа проверочных символов определяется зашумлённостью канала.
% Таким образом, д
Для выбора $\kappa$ необходимо:
\begin{enumerate}
\item Задаться конкретной общей длиной кода $\mu \leqslant \mu_{\max}$ (для $\Integerset_7$ $\mu \leqslant 6$).

\item Рассчитать прогнозируемо-максимальное количество ошибок $u_{\max}$ такое, что при передаче блока из $\mu$ символов по рассматриваемому каналу:
\begin{itemize}
\item вероятностью $u_{\max}+1$ ошибки в~блоке уже можно пренебречь, 
\item а~вероятностью $u_{\max}$ ошибок ещё нельзя.
\end{itemize}

\end{enumerate}
После расчёта принимается $\kappa = 2u_{\max}$. 
\subsubsection{К вопросу «всегда ли $\kappa$ чётно?»}

На практике "--- всегда чётно; в~некоторых источниках написано сразу «$2u_{\max}$ проверочных символов».
Использовать $\kappa = 2u_{\max}+1$ проверочных символов технически можно, но при этом:
\begin{itemize}
\item исправляется только $u_{\max}$ ошибок, как и для $\kappa = 2u_{\max}$;
\item повышается сложность расчёта как при кодировании, так и при проверке;
\item при той же общей длине блока $\mu$ число информационных символов блока $\nu = \mu - \kappa$ меньше, чем для $\kappa = 2u_{\max}$.
\end{itemize}

% \subsubsection{***}

Если $\kappa = 2u_{\max} \geqslant \mu$ "--- по рассматриваемому каналу \emph{невозможно} вести достаточно надёжную (то есть с пренебрежимо малой вероятностью неисправленной и~незамеченной ошибки) передачу блоками длины $\mu$ при помощи кодов Рида"--~Соломона (нужны другая $\mu$, другие коды или другой канал).



Так как мы рассматриваем гипотетический канал передачи данных с~неизвестным шумом, $\kappa$ на семинаре выбиралось произвольно.
Рассматривались варианты с~общей длиной $\mu=6$: %, то есть с~$\nu\mu - \kappa$ :
\begin{itemize}
\item $\kappa=2$ ($\nu=4$ информационных символа, исправление одной ошибки);
\item $\kappa=4$ ($\nu=2$ информационных символа, исправление двух ошибок);
\end{itemize}
выбрано $\kappa=2$.

\subsection{Порождающий полином Рида---Соломона}

Порождающий полином Рида"--~Соломона имеет вид:
\begin{equation}
\label{eq_gx_rs_common}
g(x) = (x - \beta)(x - \beta^{2})\dots(x - \beta^{\kappa}),
\end{equation}
что при выбранных $\beta=3$ и~$\kappa=2$ означает
\begin{equation}
\label{eq_gx_rs_sem}
g(x) = (x - 3^1)(x - 3^{2}) = (x - 3)(x - 2) = x^2 - 5x + 6 = x^2 + 2x + 6.
\end{equation}

\section{Кодирование}
Для порождающего полинома~\eqref{eq_gx_rs_sem} с~$\kappa=2$ возможно количество информационных символов $\nu$ от $1$ до $4$  %\nu_{\max}=
и, соответственно, общая длина от $3$ до $6$.
Далее рассматривается случай $\nu=4$ информационных символов и, соответственно, общая длина кода $\mu = \kappa + \nu = 2+4 = 6$.

Сообщение из $\nu$ информационных символов 
% $(a_{\nu - 1}, ..., a_2, a_1, a_0)$ или 
$(a_0, a_1, a_2,..., a_{\nu - 1})$

рассматривается как \emph{информационный полином} степени $\nu - 1$:
\begin{equation}
\label{eq_a_infopolynom_common}
a(x) = a_0 + a_1x + a_2x^2 + ... + a_{\nu - 1} x^{\nu-1}.
\end{equation}

\emph{Систематический} полиномиальный код, в~том числе код Рида"--~Соломона "--- это полином $C(x)$, который должен:
\begin{itemize}
\item делиться на порождающий %полином 
$g(x)$ "--- как любой полиномиальный код;
\item содержать в~явном виде информационные символы $(a_0, a_1, a_2,..., a_{\nu - 1})$ (коэффициенты $a(x)$) "--- как любой систематический код;
\end{itemize}
и~получается следующим образом:
\begin{equation}
\label{eq_c_codepolynom_common}
C(x) = a(x)\cdot x^\kappa - r(x),
\end{equation}
где $r(x) = a(x)\cdot x^\kappa \bmod g(x)$. 

\pagebreak[3]

То есть:
\begin{itemize}
\item информационные символы сдвигаются на $\kappa$ позиций, чтобы освободить место для проверочных 
($a(x)\cdot x^\kappa$ содержит $(a_0, a_1, a_2,..., a_{\nu - 1})$ в~правильном порядке, но в~общем случае не делится на $g(x)$);
\item освободившиеся $\kappa$ позиций заполняются так, чтобы результат делился на $g(x)$:
\begin{equation}
\begin{array}{c}
C(x) \bmod g(x) = \Big( a(x)\cdot x^\kappa - r(x) \Big) \bmod g(x)  = \\
= \Big( a(x)\cdot x^\kappa \bmod g(x) \Big) - \Big(r(x) \bmod g(x) \Big)
= r(x) - r(x) = 0,
\end{array}
\end{equation}
$r(x)$ имеет не более $\kappa$ коэффициентов: $deg(r) \leqslant deg(g)-1 = \kappa-1$.
\end{itemize}

\section{Кодирование конкретного сообщения}

На семинаре рассматривалось сообщение $(1, 1, 1, 1)$, то есть полином
\begin{equation}
\label{eq_a_infopolynom_sem}
a(x) = 
% 1 + x + x^2 + x^3
x^3 + x^2 + x + 1
.
\end{equation}

\subsection{На семинаре обсчитались при делении}

При делении на доске в~столбик $a(x)\cdot x^2 = x^5 + x^4 + x^3 + x^2$ на $g(x) = x^2 + 2x + 6$ получили $r(x) = -x-3$, то есть:
\begin{equation}
\label{eq_c_codepolynom_sem}
C(x) = a(x)\cdot x^2 - r(x)  = x^5 + x^4 + x^3 + x^2 + x + 3.
\end{equation}
На семинаре проверяли делением $C(x)$ на $g(x) = x^2 + 2x + 6$ онлайн (над $\Realset$) "--- получили в~остатке $-7x-75$, а 75 не кратно 7.

Проверим иначе: делится ли $C(x)$ на $g(x) = (x - 3)(x - 2)$ "--- рассчитаем в~Octave $C(2)$ и~$C(3)$ в~$\Realset$.
\begin{lstlisting}
octave:1> x=2
x =  2
octave:2> x^5 + x^4 + x^3 + x^2 + x + 3
ans =  65
octave:4> x=3
x =  3
octave:5> x^5 + x^4 + x^3 + x^2 + x + 3
ans =  366
\end{lstlisting}
Получили значения $65 = 7\cdot9 + 2$ и~$366 = 52\cdot7+ 2$
% , не кратные 7
"--- то есть в~$\Integerset_7$ полином \eqref{eq_c_codepolynom_sem} не имеет корней в~точках 2 и 3.

\subsection{Исправляем ошибку}

При повторном делении $a(x)\cdot x^2 = x^5 + x^4 + x^3 + x^2$ на $g(x) = x^2 + 2x + 6$ в~столбик, уже после семинара, было получено $r(x) = -x+6 = -x-1$, то есть 
\begin{equation}
\label{eq_c_codepolynom_sem_correct}
C(x) = a(x)\cdot x^2 - r(x)  = x^5 + x^4 + x^3 + x^2 + x + 1.
\end{equation}

В этом случае при делении $C(x)$ на $g(x)$ онлайн  $-7x-77$ в~остатке "--- всё-таки и~тут коэффициенты должны быть нулевые или кратные 7!

Значения $C(2)$ и~$C(3)$ в~$\Realset$, рассчитанные в~Octave:
\begin{lstlisting}
octave:10> x=2
x =  2
octave:11> x^5 + x^4 + x^3 + x^2 + x + 1
ans =  63
octave:12> x=3
x =  3
octave:13> x^5 + x^4 + x^3 + x^2 + x + 1
ans =  364
octave:14> 63/7, 364/7
ans =  9
ans =  52
\end{lstlisting}
делятся без остатка на 7 в~$\Realset$, то есть нулевые в~$\Integerset_7$ $\implies$ $C(x)$ делится на $x-2$ и~$x-3$, то есть и~на $g(x)$.


\section{Проверка и~декодирование}

Декодирование систематического кода тривиально, так как информационные символы содержатся в~нём в~явном виде.
Но они могут оказаться искажёнными, то есть перед чтением необходимо проверить корректность сообщения.

\subsection{Проверка корректности}

Корректность полученного сообщения  $\widetilde{C}(x)$ определяет \emph{синдром} "--- многочлен степени $\kappa-1$
\begin{equation}
\label{eq_c_syndrome_common}
s(x) = s_0 + s_1 x + ... + s_{\kappa-1} x^{\kappa-1}.
\end{equation}
где 
\begin{equation}
\label{eq_c_syndrome_common_coeff}
s_i = \widetilde{C}(\beta^{i+1}).
\end{equation}
Нулевой синдром соответствует корректному (делящемуся на $g(x)$) сообщению $\widetilde{C}(x)$.
Действительно, если  $\widetilde{C}(x)$ делится на $g(x)$ ($\widetilde{C}(x) = A(x)\cdot g(x)$), то все
коэффициенты $s_i$ нулевые, так как соответствующие $\beta^{i+1}$ "--- корни $g(x)$.


Считается, что делящееся на $g(x)$ (с~нулевым синдромом) полученное сообщение $\widetilde{C}(x)$ есть неискажённое $C(x)$.

Сообщение с~ненулевым синдромом "--- искажено: 
\begin{equation}
\widetilde{C}(x) = C(x) + e(x),
\end{equation}
необходима коррекция.
Степень $e(x)$ в~общем случае может быть равна степени $C(x)$, 
но
%При этом 
число ненулевых коэффициентов $e(x)$ (количество ошибок~$u$) не превышает $u_{\max} = \left\lfloor\frac{\kappa}{2}\right\rfloor$
($\kappa$ выбиралось так, что вероятностью $u > \frac{\kappa}{2}$ можно пренебречь).

При этом, так как ${C}(\beta^{i+1})=0$ ($C(x)$ делится на $g(x)$, то есть делится и~на все его делители $x-\beta^{i+1}$), то синдром характеризует только ошибку $e(x)$:
\begin{equation}
s_i = \widetilde{C}(\beta^{i+1}) = C(\beta^{i+1})+ e(\beta^{i+1}) = e(\beta^{i+1})
\end{equation}

\subsection{Ошибки рассматриваемого кода}

Для~\eqref{eq_gx_rs_sem} $u_{\max} = 1$, то есть ошибка  $e(x)$ либо равна $0$ (и~делится на $g(x)$), либо имеет только один ненулевой коэффициент и~имеет вид 
\begin{equation}
e(x) = A x^k,
\end{equation}
где $0 \leqslant k \leqslant \mu-1$, $A\neq0$.

При делении на $g(x)$ все возможные $e(x)$ дают разные остатки (таблица~\ref{tab_e_r}).
\begin{table}[!h]
\caption{Возможные остатки от деления $e(x) = A x^k$ на $g(x)$}
\label{tab_e_r}
$
\begin{array}{|c|c|c|c|c|c|c|}\hline
% A x^k \bmod g(x)
    & k=0   & k=1   & k=2   & k=3   & k=4   & k=5  \\\hline
A=1 & 1     & x     & 5x+1  & 5x+5  & 2x+5  & x+2   \\
A=2 & 2     & 2x    & 3x+2  & 3x+3  & 4x+3  & 2x+4  \\
A=3 & 3     & 3x    & x+3   & x+1   & 6x+1  & 3x+6  \\
A=4 & 4     & 4x    & 6x+4  & 6x+6  & x+6   & 4x+1  \\
A=5 & 5     & 5x    & 4x+5  & 4x+4  & 3x+4  & 5x+3  \\
A=6 & 6     & 6x    & 2x+6  & 2x+2  & 5x+2  & 6x+5  \\\hline
\end{array}
$
\end{table}

% По теореме Безу e mod (x-2) = e(2)

Рассмотрим остатки от деления $e(x) = A x^k$ на $x-3$ и $x-2$ (таблица~\ref{tab_e_r_3_2}).
%
\begin{table}[!h]
\caption{Возможные остатки от деления $e(x) = A x^k$ на двучлены $x-3$ и $x-2$}
\label{tab_e_r_3_2}
$
\begin{array}{|c|c|c|c|c|c|c|}\hline
A x^k \bmod (x-3) = A\cdot 3^k 
    & k=0   & k=1 & k=2 & k=3 & k=4 & k=5 \\\hline
A=1 & 1     & 3   & 2   & 6   & 4   & 5   \\
A=2 & 2     & 6   & 4   & 5   & 1   & 3   \\
A=3 & 3     & 2   & 6   & 4   & 5   & 1   \\
A=4 & 4     & 5   & 1   & 3   & 2   & 6   \\
A=5 & 5     & 1   & 3   & 2   & 6   & 4   \\
A=6 & 6     & 4   & 5   & 1   & 3   & 2   \\\hline
\end{array}
$

$
\begin{array}{|c|c|c|c|c|c|c|}
\hline
A x^k \bmod (x-2) = A\cdot 2^k 
    & k=0   & k=1 & k=2 & k=3 & k=4 & k=5 \\\hline
A=1 & 1     & 2   & 4   & 1   & 2   & 4   \\
A=2 & 2     & 4   & 1   & 2   & 4   & 1   \\
A=3 & 3     & 6   & 5   & 3   & 6   & 5   \\
A=4 & 4     & 1   & 2   & 4   & 1   & 2   \\
A=5 & 5     & 3   & 6   & 5   & 3   & 6   \\
A=6 & 6     & 5   & 3   & 6   & 5   & 3   \\\hline
\end{array}
$
\end{table}%
%
По теореме Безу $e(x) \bmod (x-a) = e(a) = A a^k$.
Видно, 
что ни для одного $e(x) = A x^k$ не совпадают оба остатка $A x^k \bmod (x-3) = A\cdot 3^k$ и~$A x^k \bmod (x-2) = A\cdot 2^k$,
то есть по остатку от деления на $g(x)$ или по значениям $e(3)$ и~$e(2)$ (коэффициентам синдрома) можно найти $e(x)$.


\subsection{Синдром рассматриваемого кода}

Для~\eqref{eq_gx_rs_sem} с~$\kappa=2$ синдром линеен:
\begin{equation}
\label{eq_c_syndrome_sem_common}
s(x) =  \widetilde{C}(\beta^{1}) x^0 + \widetilde{C}(\beta^{2}) x^1 
= \widetilde{C}(\beta) + \widetilde{C}(\beta^{2}) x
= \widetilde{C}(3) + \widetilde{C}(2) x
.
\end{equation}

\subsection{Исправление сообщения с~ненулевым синдромом}

Если у~полученного сообщения $\widetilde{C}(x)$ ненулевой синдром, то при передаче произошло %некоторое количество 
$u$ ошибок, $1 \leqslant u \leqslant u_{\max} = \left\lfloor\frac{\kappa}{2}\right\rfloor$. 
%($\kappa$ выбиралось так, что вероятностью $u > \frac{\kappa}{2}$ можно пренебречь).

Для исправления необходимо найти два полинома:
\begin{enumerate}
\item Многочлен локаторов $L(x)$ степени $u$ вида:
\begin{equation}
L(x) = (1 - xX_1)(1 - xX_2)\ldots(1 - xX_u)
\end{equation}
где константа $X_i \in \Integerset_7\setminus \{0\}$ "--- \emph{локатор ошибки:} $X_i = \beta^\ell$ указывает, что коэффициент при $x^\ell$ был передан с~ошибкой.

\item Многочлен ошибок $W(x)$ степени $u-1$.
\end{enumerate}

Оба многочлена "--- $L(x)$ и~$W(x)$ "--- находятся из соотношения:
\begin{equation}
\label{eq_c_syndrome_L_W}
L(x)\cdot S(x) = W(x) \mod x^\kappa,
\end{equation}
причём поиск их коэффициентов "--- самая сложная часть исправления ошибок.
Неизвестная степень $u$ вначале полагается равной $u_{\max} = \frac{\kappa}{2}$; при вычислении часть коэффициентов может оказаться нулевой.

После вычисления $L(x)$ и~$W(x)$ для каждого локатора $X_i$ находим значение, которое необходимо добавить к~соответствующему коэффициенту для исправления ошибки
\begin{equation}
\label{eq_c_syndrome_Y_common}
Y_i = \frac{W(X_i^{-1})}{L'(X_i^{-1})},
\end{equation}
где штрих "--- производная по $x$; тогда
\begin{equation}
C(c) = \widetilde{C}(x) + \sum Y_i \cdot x^{\ell_i}.
\end{equation}


\subsection{Многочлены локаторов и~ошибок рассматриваемого кода}

В~общем случае для~\eqref{eq_gx_rs_sem} с~$\kappa=2$, исправляющего $u_{\max} = 1$ ошибку, многочлен локаторов линеен:
\begin{equation}
L(x) = 1 - xX_1 = 1 - a x,
\end{equation}
а~многочлен ошибок степени $u_{\max} - 1$ представляет собой константу:
\begin{equation}
W(x) = c.
\end{equation}
Таким образом $L'(x) = - a$, и~выражение~\eqref{eq_c_syndrome_Y_common} для коррекции ошибки в~месте локатора $X_i$:
\begin{equation}
\label{eq_c_syndrome_Y_sem}
Y_1 = \frac{W(X_i^{-1})}{L'(X_i^{-1})} = \frac{c}{-a}.
\end{equation}

\section{Проверка и~декодирование конкретного сообщения}

Для неискажённого $C(x) = x^5 + x^4 + x^3 + x^2 + x + 1$ синдром равен $0+0x$  (выше проверено $C(3)=C(2)=0$).

Внесём искажение: пусть получено 
\begin{equation}
\label{eq_c_err}
\widetilde{C}(x) = x^5 + x^4 + x^3 + x^2 + x + 3
\end{equation}
его синдром
\begin{equation}
\label{eq_c_err_syndrome_sem}
s(x) =  \widetilde{C}(3) + \widetilde{C}(2) x = 2 + 2x.
\end{equation}
отличен от нуля, то есть надо найти коэффициенты многочленов $L(x) = 1 - a x$ и~$W(x) = c$ из соотношения~\eqref{eq_c_syndrome_L_W}:
\begin{equation}
(1 - a x)\cdot S(x) = c \mod x^2,
\end{equation}
то есть 
\begin{equation}
(1 - a x)\cdot (2 + 2x) = c \mod x^2,
\end{equation}
% раскрывая скобки:
\begin{equation}
2 + 2x
- 2a x - 2a x^2
= c \mod x^2,
\end{equation}
получаем систему уравнений:
\begin{equation}
\left\{
\begin{array}{@{}c@{~}c@{~}cl@{}}
2 &=& c  \\
2 - 2 a &=& 0 \\
\end{array}
\right.
\end{equation}
откуда $a=1$ и~$c=2$.

Так как локатор единственной ошибки $X_1 = a=1=3^0$ "--- ошибка в~коэффициенте при $x^0$ (свободном члене);
добавить к~нему, согласно~\eqref{eq_c_syndrome_Y_sem}, необходимо величину
\begin{equation}
Y_1 = \frac{c}{-a} = \frac{2}{-1} = -2 = 5.
\end{equation}
Действительно, 
\begin{equation}
\widetilde{C}(x) + Y_1 x^0 = x^5 + x^4 + x^3 + x^2 + x + 3 -2 = x^5 + x^4 + x^3 + x^2 + x + 1 = C(x)
\end{equation}
\end{document}
